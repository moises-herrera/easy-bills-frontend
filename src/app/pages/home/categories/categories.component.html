<div class="section-content">
  <h4 class="section-title">Categor√≠as</h4>
  <p-divider />

  <span class="p-input-icon-left">
    <i class="pi pi-search"></i>
    <input
      type="text"
      pInputText
      [(ngModel)]="search"
      (ngModelChange)="searchCategories()"
      placeholder="Buscar"
    />
  </span>

  <button
    pButton
    label="Agregar"
    icon="pi pi-plus"
    class="p-button-rounded ml-3"
    (click)="showCategoryModal()"
  ></button>
</div>

@if (isLoading) {
  <div class="loading-indicator loading-indicator-section">
    <p-progressSpinner strokeWidth="4" />
  </div>
}

@if ({ data: (categories$ | async) }; as categories) {
  @if (categories.data?.length) {
    @for (category of categories.data; track category.id) {
      <article class="section-content">
        <div class="flex justify-between items-center flex-wrap">
          <div class="flex items-center space-x-4">
            <div
              class="category-icon"
              [style.background-color]="category.color || '#000'"
            >
              <i [ngClass]="category.icon" class="text-white"></i>
            </div>
            <div class="font-semibold truncate">{{ category.name }}</div>
          </div>
          <div>
            <span class="text-gray-400 truncate">{{ category.description }}</span>
          </div>
          <div>
            @if (category.userId === user.id) {
              <button
                #btn
                type="button"
                pButton
                icon="pi pi-ellipsis-v"
                class="p-button-secondary p-button-text p-button-sm"
                (click)="menu.toggle($event)"
              ></button>
              <p-menu
                #menu
                [model]="options"
                [popup]="true"
                (click)="onClickCategory(category.id)"
              />
            }
          </div>
        </div>
      </article>
    }
  }

  @if (!isLoading && !categories.data?.length) {
    <app-no-data />
  }

  <p-paginator
    (onPageChange)="onPageChange($event)"
    [first]="first"
    [rows]="pageSize"
    [totalRecords]="totalRecords"
    [rowsPerPageOptions]="[10, 20, 30]"
  />
}


<app-modal-category
  [(isVisible)]="isModalVisible"
  [(categoryId)]="categoryId"
  (reloadData)="getCategories()"
/>

<p-confirmDialog
  [styleClass]="'confirm-dialog'"
  acceptLabel="Si"
  rejectLabel="No"
  acceptButtonStyleClass="p-button-primary"
  rejectButtonStyleClass="p-button-danger"
/>
